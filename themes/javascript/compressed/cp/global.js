/*!
 * ExpressionEngine - by EllisLab
 *
 * @package		ExpressionEngine
 * @author		ExpressionEngine Dev Team
 * @copyright	Copyright (c) 2003 - 2011, EllisLab, Inc.
 * @license		http://expressionengine.com/user_guide/license.html
 * @link		http://expressionengine.com
 * @since		Version 2.0
 * @filesource
 */

jQuery(document).ready(function(){function c(){var d=EE.SESS_TIMEOUT-6E4,e=EE.XID_TIMEOUT-6E4,b=d<e?d:e,f=false,g,j;j=function(){a.ajax({type:"POST",dataType:"json",url:EE.BASE+"&C=login&M=refresh_xid",success:function(h){a("input[name='XID']").val(h.xid);EE.XID=h.xid;setTimeout(j,e)}})};g=function(){var h='<form><div id="logOutWarning" style="text-align:center"><p>'+EE.lang.session_expiring+'</p><label for="username">'+EE.lang.username+'</label>: <input type="text" id="log_backin_username" name="username" value="" style="width:100px" size="35" dir="ltr" id="username" maxlength="32"  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<label for="password">'+
EE.lang.password+'</label>: <input class="field" id="log_backin_password" type="password" name="password" value="" style="width:100px" size="32" dir="ltr" id="password" maxlength="32"  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="submit" id="submit" name="submit" value="'+EE.lang.login+'" class="submit" /><span id="logInSpinner"></span></div></form>',i;if(f===true){(void 0)(f);return false}else setTimeout(void 0,b);a.ee_notice(h,{type:"custom",open:true,close_on_click:false});i=a("#logOutWarning");
i.find("#log_backin_username").focus();i.find("input#submit").click(function(){var l=i.find("input#log_backin_username").val(),o=i.find("input#log_backin_password").val(),m=a(this),n=i.find("span#logInSpinner");m.hide();n.html('<img src="'+EE.PATH_CP_GBL_IMG+'loader_blackbg.gif" />');a.ajax({type:"POST",dataType:"json",url:EE.BASE+"&C=login&M=authenticate&is_ajax=true",data:{username:l,password:o,XID:EE.XID},success:function(k){f=true;if(k.messageType==="success"){a("input[name='XID']").val(k.xid);
i.slideUp("fast");a.ee_notice(k.message,{type:"custom",open:true});EE.XID=k.xid;f=true;clearTimeout(g);setTimeout(g,b)}else if(k.messageType==="failure"){i.before('<div id="loginCheckFailure">'+k.message+"</div>");n.hide("fast");m.css("display","inline")}else if(k.messageType==="logout")window.location.href=EE.BASE+"&C=login&M=logout&auto_expire=true"}});return false})};EE.SESS_TYPE==="c"?setTimeout(j,e):setTimeout(g,b)}var a=jQuery;a(document).bind("ajaxComplete",function(d,e){if(e.status&&+e.status===
401)window.location=EE.BASE+"&"+e.responseText});false in document.createElement("input")&&EE.insert_placeholders();a('a[rel="external"]').click(function(){window.open(this.href);return false});finalLogOutTimer=function(d){var e=a('<div id="logOutConfirm">'+EE.lang.session_timeout+" </div>"),b=30,f=b,g,j,h,i;h=function(){window.location=EE.BASE+"&C=login&M=logout&auto_expire=true"};i=function(){if(b<1)return setTimeout(h,0);else b===f&&a(window).bind("unload.logout",h);e.dialog("option","title",EE.lang.logout+
" ("+(b--||"...")+")");g=setTimeout(i,1E3)};j={Cancel:function(){a(this).dialog("close")}};j[EE.lang.logout]=h;e.dialog({autoOpen:false,resizable:false,modal:true,title:EE.lang.logout,position:"center",minHeight:"0",buttons:j,beforeClose:function(){clearTimeout(g);a(window).unbind("unload.logout");b=f;a.ajax({type:"POST",dataType:"json",url:EE.BASE+"&C=login&M=refresh_xid",success:function(l){a("input[name='XID']").val(l.xid);EE.XID=l.xid;a("#logOutWarning").slideUp("fast");c()}});d=false}});a("#logOutConfirm").dialog("open");
a(".ui-dialog-buttonpane button:eq(2)").focus();i();return false};EE.SESS_TIMEOUT&&c();EE.cp.show_hide_sidebar();EE.flashdata!==undefined&&EE.cp.display_notices();EE.notepad=function(){var d=a("#notePad"),e=a("#notepad_form"),b=a("#notePadTextEdit"),f=a("#notePadControls"),g=a("#notePadText").removeClass("js_show"),j=g.text(),h=b.val();return{init:function(){h&&g.html(h.replace(/</ig,"&lt;").replace(/>/ig,"&gt;").replace(/\n/ig,"<br />"));d.click(EE.notepad.show);f.find("a.cancel").click(EE.notepad.hide);
e.submit(EE.notepad.submit);f.find("input.submit").click(EE.notepad.submit);b.autoResize()},submit:function(){h=a.trim(b.val());var i=h.replace(/</ig,"&lt;").replace(/>/ig,"&gt;").replace(/\n/ig,"<br />");b.attr("readonly","readonly").css("opacity",0.5);f.find("#notePadSaveIndicator").show();a.post(e.attr("action"),{notepad:h,XID:EE.XID},function(){g.html(i||j).show();b.attr("readonly","").css("opacity",1).hide();f.hide().find("#notePadSaveIndicator").hide()},"json");return false},show:function(){if(f.is(":visible"))return false;
var i="";if(g.hide().text()!==j)i=g.html().replace(/<br>/ig,"\n").replace(/&lt;/ig,"<").replace(/&gt;/ig,">");f.show();b.val(i).show().height(0).focus().trigger("keypress")},hide:function(){g.show();b.hide();f.hide();return false}}}();EE.notepad.init();EE.cp.accessory_toggle();EE.cp.control_panel_search();a("h4","#quickLinks").click(function(){window.location.href=EE.BASE+"&C=myaccount&M=quicklinks"}).add("#notePad").hover(function(){a(".sidebar_hover_desc",this).show()},function(){a(".sidebar_hover_desc",
this).hide()}).css("cursor","pointer");EE.cp.logout_confirm();a(".js_show").show()});EE.namespace=function(c){c=c.split(".");var a=EE;if(c[0]==="EE")c=c.slice(1);for(var d=0,e=c.length;d<e;d+=1){if(typeof a[c[d]]==="undefined")a[c[d]]={};a=a[c[d]]}return a};EE.namespace("EE.cp");
EE.cp.accessory_toggle=function(){$("#accessoryTabs li a").click(function(c){c.preventDefault();c=$(this).parent("li");var a=$("#"+this.className);if(c.hasClass("current")){a.hide();c.removeClass("current")}else{if(c.siblings().hasClass("current")){a.show().siblings(":not(#accessoryTabs)").hide();c.siblings().removeClass("current")}else a.slideDown();c.addClass("current")}})};
EE.cp.control_panel_search=function(){var c=$("#search"),a=c.clone(),d=$("#cp_search_form").find(".searchButton"),e;e=function(){var b=$(this).attr("action"),f={cp_search_keywords:$("#cp_search_keywords").attr("value")};$.ajax({url:b+"&ajax=y",data:f,beforeSend:function(){d.toggle()},success:function(g){d.toggle();c=c.replaceWith(a);a.html(g);$("#cp_reset_search").click(function(){a=a.replaceWith(c);$("#cp_search_form").submit(e);$("#cp_search_keywords").select();return false})},dataType:"html"});
return false};$("#cp_search_form").submit(e)};
EE.cp.show_hide_sidebar=function(){var c={revealSidebarLink:"77%",hideSidebarLink:"100%"},a=$("#mainContent"),d=$("#sidebarContent"),e=a.height(),b=d.height(),f;if(EE.CP_SIDEBAR_STATE==="n"){a.css("width","100%");$("#revealSidebarLink").css("display","block");$("#hideSidebarLink").hide();d.show();b=d.height();d.hide()}else{d.hide();e=a.height();d.show()}f=b>e?b:e;$("#revealSidebarLink, #hideSidebarLink").click(function(){var g=$(this),j=g.siblings("a"),h=this.id==="revealSidebarLink";$.ajax({type:"POST",
dataType:"json",url:EE.BASE+"&C=myaccount&M=update_sidebar_status",data:{XID:EE.XID,show:h},success:function(){}});$("#sideBar").css({position:"absolute","float":"",right:"0"});g.hide();j.css("display","block");d.slideToggle();a.animate({width:c[this.id],height:h?f:e},function(){a.height("");$("#sideBar").css({position:"","float":"right"})});return false})};
EE.cp.display_notices=function(){var c=$(".notice").filter("p.js_hide"),a={success:"message_success",notice:"message",error:"message_failure"},d=[],e=0,b,f;for(b in a)if(EE.flashdata.hasOwnProperty(a[b])){f=b==="error"?c.filter(".failure").slice(0,1):b==="success"?c.filter(".success").slice(0,1):c.slice(0,1);d[e++]={message:EE.flashdata[a[b]],type:b};f.remove()}d.length&&$.ee_notice(d)};
EE.insert_placeholders=function(){$('input[type="text"]').each(function(){if(this.placeholder){var c=$(this),a=this.placeholder,d=c.css("color");c.val()==""&&c.data("user_data","n");c.focus(function(){c.css("color",d);if(c.val()===a){c.val("");c.data("user_data","y")}}).blur(function(){if(c.val()===""||c.val===a){c.val(a).css("color","#888");c.data("user_data","n")}}).trigger("blur")}})};
EE.cp.logout_confirm=function(){$("#activeUser").one("mouseover",function(){var c=$('<div id="logOutConfirm">'+EE.lang.logout_confirm+" </div>"),a=30,d=a,e,b,f,g;f=function(){$.ajax({url:EE.BASE+"&C=login&M=logout",async:!$.browser.safari});window.location=EE.BASE+"&C=login&M=logout"};g=function(){if(a<1)return setTimeout(f,0);else a===d&&$(window).bind("unload.logout",f);c.dialog("option","title",EE.lang.logout+" ("+(a--||"...")+")");e=setTimeout(g,1E3)};b={Cancel:function(){$(this).dialog("close")}};
b[EE.lang.logout]=f;c.dialog({autoOpen:false,resizable:false,modal:true,title:EE.lang.logout,position:"center",minHeight:"0",buttons:b,beforeClose:function(){clearTimeout(e);$(window).unbind("unload.logout");a=d}});$("a.logOutButton",this).click(function(){$("#logOutConfirm").dialog("open");$(".ui-dialog-buttonpane button:eq(2)").focus();g();return false})})};
EE.cp.live_url_title=function(c,a){var d=EE.publish.default_entry_title?EE.publish.default_entry_title:"",e=EE.publish.word_separator,b=c.val()||"",f=RegExp(e+"{2,}","g"),g=e!=="_"?/\_/g:/\-/g,j="",h=EE.publish.url_title_prefix?EE.publish.url_title_prefix:"";if(d!==""&&c.attr("id")==="title")if(b.substr(0,d.length)===d)b=b.substr(d.length);b=h+b;b=b.toLowerCase().replace(g,e);for(d=0;d<b.length;d++){g=b.charCodeAt(d);if(g>=32&&g<128)j+=b.charAt(d);else if(g in EE.publish.foreignChars)j+=EE.publish.foreignChars[g]}b=
j;b=b.replace("/<(.*?)>/g","");b=b.replace(/\s+/g,e);b=b.replace(/\//g,e);b=b.replace(/[^a-z0-9\-\._]/g,"");b=b.replace(/\+/g,e);b=b.replace(f,e);b=b.replace(/^[-_]|[-_]$/g,"");b=b.replace(/\.+$/g,"");a&&a.val(b.substring(0,75))};
